# Timeline Editing - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ

## –û–±–∑–æ—Ä

Timeline Panel –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–±—Ä–µ–∑–∫–∏ –≤–∏–¥–µ–æ —Å –ø–æ–º–æ—â—å—é –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ timeline –≤–∏–¥–∂–µ—Ç–∞.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. Timeline Widget

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π timeline –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –≤–∏–¥–µ–æ:

- **Drag & Drop –º–∞—Ä–∫–µ—Ä—ã** - –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∑–µ–ª—ë–Ω—ã–π (–Ω–∞—á–∞–ª–æ) –∏ –∫—Ä–∞—Å–Ω—ã–π (–∫–æ–Ω–µ—Ü) –º–∞—Ä–∫–µ—Ä—ã
- **Click to select** - –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ timeline –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–∫–∏ –∫–∞–∂–¥—ã–µ 10% –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–í—ã–¥–µ–ª–µ–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å** - —Å–∏–Ω—è—è –∑–æ–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç

### 2. –ö–æ–Ω—Ç—Ä–æ–ª—ã –≤—Ä–µ–º–µ–Ω–∏

–¢–æ—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ø–æ–ª—è –≤–≤–æ–¥–∞:

```
‚ñ∂Ô∏è –ù–∞—á–∞–ª–æ: 00:00:15
‚èπÔ∏è –ö–æ–Ω–µ—Ü:   00:05:30
‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 00:05:15
```

–§–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏: `HH:MM:SS` (—Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è `MM:SS` –∏ `SS`)

### 3. –û–ø–µ—Ä–∞—Ü–∏–∏

#### Trim Video

–û–±—Ä–µ–∑–∫–∞ –≤–∏–¥–µ–æ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç—É:

```python
# –í—ã—Ö–æ–¥: video_trimmed_15-330.mp4
# (–Ω–∞—á–∞–ª–æ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö - –∫–æ–Ω–µ—Ü –≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç `VideoProcessor.trim_video()` —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–∞—á–µ—Å—Ç–≤–∞ (`-c copy`).

#### Reset Selection

–°–±—Ä–æ—Å –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –≤—Å—ë –≤–∏–¥–µ–æ (–ø–æ–ª–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å).

## API

### TimelinePanel

```python
from ui.timeline_panel import TimelinePanel

panel = TimelinePanel(
    parent,
    on_video_edited=callback  # Optional[Callable[[str], None]]
)

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ
panel.load_video(Path("video.mp4"))
```

### Callback

```python
def on_video_edited(output_path: str):
    """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–µ–∑–∫–∏"""
    print(f"–í–∏–¥–µ–æ –æ–±—Ä–µ–∑–∞–Ω–æ: {output_path}")
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Canvas Rendering

Timeline –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ Tkinter Canvas:

- **Background**: `#1a1a1a` (—Ç—ë–º–Ω—ã–π)
- **Selected area**: `#3b8eea` (—Å–∏–Ω–∏–π —Å stipple)
- **Start marker**: `#4CAF50` (–∑–µ–ª—ë–Ω—ã–π)
- **End marker**: `#F44336` (–∫—Ä–∞—Å–Ω—ã–π)

### Timeline Calculations

```python
# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∫–ª–∏–∫–∞ –≤ –≤—Ä–µ–º—è
click_time = ((event.x - padding) / timeline_width) * duration

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø–æ–∑–∏—Ü–∏—é
marker_x = padding + (time / duration) * timeline_width
```

### FFprobe Integration

–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ:

```bash
ffprobe -v error -show_entries format=duration \
  -of default=noprint_wrappers=1:nokey=1 video.mp4
```

## UI/UX

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

1. **Click** - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—É—é —Ç–æ—á–∫—É (–±–ª–∏–∂–∞–π—à–∏–π –º–∞—Ä–∫–µ—Ä)
2. **Drag** - –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å –º–∞—Ä–∫–µ—Ä
3. **Release** - –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

- ‚úÖ **–ó–µ–ª—ë–Ω—ã–π –º–∞—Ä–∫–µ—Ä** - –Ω–∞—á–∞–ª–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞
- ‚ùå **–ö—Ä–∞—Å–Ω—ã–π –º–∞—Ä–∫–µ—Ä** - –∫–æ–Ω–µ—Ü —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞
- üìä **–°–∏–Ω—è—è –æ–±–ª–∞—Å—Ç—å** - –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç
- üî¢ **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏** - –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
# 1. –°–æ–∑–¥–∞—Ç—å –ø–∞–Ω–µ–ª—å
timeline = TimelinePanel(parent)

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ
timeline.load_video(Path("long_video.mp4"))

# 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç –Ω–∞ timeline
# 4. –ù–∞–∂–∏–º–∞–µ—Ç "–û–±—Ä–µ–∑–∞—Ç—å –≤–∏–¥–µ–æ"
# 5. –†–µ–∑—É–ª—å—Ç–∞—Ç: long_video_trimmed_START-END.mp4
```

### –° callback

```python
def handle_trimmed_video(output_path: str):
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ Preview
    preview_panel.load_video(Path(output_path))
    
    # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
    print(f"‚úÖ –ì–æ—Ç–æ–≤–æ: {output_path}")

timeline = TimelinePanel(
    parent,
    on_video_edited=handle_trimmed_video
)
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
python3 -m unittest tests.test_timeline_panel -v
```

### Test Coverage

- ‚úÖ `test_format_time` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—É–Ω–¥ –≤ HH:MM:SS
- ‚úÖ `test_parse_time` - –ø–∞—Ä—Å–∏–Ω–≥ HH:MM:SS –≤ —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ `test_parse_time_invalid` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **customtkinter** - UI framework
- **VideoProcessor** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (ffmpeg)
- **subprocess** - ffprobe –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- Timeline —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
- –¢—Ä–µ–±—É–µ—Ç—Å—è ffmpeg/ffprobe –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- Canvas UI (–Ω–µ –Ω–∞—Ç–∏–≤–Ω—ã–π video player)

## Roadmap

- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ (multi-clip)
- [ ] Fade in/out –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö
- [ ] –ó—É–º timeline –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞
- [ ] Waveform visualization
- [ ] Keyboard shortcuts (Space - play/pause, Arrow keys - frame-by-frame)
